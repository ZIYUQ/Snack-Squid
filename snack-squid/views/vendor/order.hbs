<link rel="stylesheet" href="/vendor/css/open.css">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Antic+Slab&family=Raleway&display=swap" rel="stylesheet">

<section id='order'>
    <title>order</title>
    <a class="logo" href="/vendor"></a>
    <a class="profile" href="/vendor/profile"><i class="fas fa-user-circle"></i></a>


    <a href='/vendor/profile/logout' class="logout"> Logout </a>


    <div class="state">
        <button id="preparingButton" onclick="preparingButton()">Outstanding </button>
        <button id="fulfilledButton" onclick="fulfilledButton()">Fulfilled</button>
    </div>

            
    <div class='preparingOrders' id="preparingOrders">
        {{#each preparingOrders}}
        {{!-- <div class="oneOrder">
            <div class="orderNum">
                <span>Order No.</span>
                <span class="orderId" hidden>{{this._id}}</span>
                <span>{{this.orderNo}}</span>
                <span>Time remaining: </span>
                <button id="fulfilled"> Mark as Fulfilled</button>
                <button>Hide</button>
            </div>

            <div class="orderDetail">
                <span>Customer Name: </span>
                <span>{{this.customerId.givenName}}</span>
                <span>Orders</span>
                <span class="detail">{{this.details}}</span> --}}

        <div class="oneOrder">
                <table class="orderNum">
                    <tr>
                        <td>Order No. <span class="orderId" hidden>{{this._id}}</span> <span>{{this.orderNo}}</span></td>
                        <td>Time remaining:</td>
                    </tr>

                    <tr>
                        <td><button>Hide</button></td>
                        <td><button id="fulfilled"> Mark as Fulfilled</button></td>
                    </tr>
                    
                </table>

                <table class="orderDetail">
                    <tr>
                        <td>Customer Name: {{this.customerId.givenName}}</td>
                    </tr>
                    
                    <tr>
                        <td><span class="detail">{{this.details}}</span></td>
                    </tr>
                </table>
        </div>
        {{/each}}
    </div>



        <script>
            orderNums = document.querySelectorAll('.orderNum')
            for (let i = 0; i < orderNums.length; i++) {
                let fulfillbtn = document.querySelector('#fulfilled')
                console.log(fulfillbtn)
                let orderId = document.querySelector('.orderId').innerHTML
                console.log(orderId)
                fulfillbtn.addEventListener('click', function () {

                    const options = {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ 'orderId': orderId }),
                        redirect: 'follow'
                    }
                    try {
                        url = window.location.href + '/fulfill-order'
                        fetch(url, options).then(res => {
                            if (res.redirected) {
                                window.location.href = url
                            }
                        })
                    }
                    catch (err) {
                        console.log(err)
                    }
                })
            }

            orderDetail = document.querySelectorAll('.orderDetail')
            for (let i = 0; i < orderDetail.length; i++) {
                let tds = orderDetail[i].getElementsByClassName('detail');
                let foods;
                let details;

                for (let j = 0; j < tds.length; j++) {
                    if (tds[j].className == "detail") {
                        foods = JSON.parse(tds[j].innerHTML);
                        details = tds[j];
                    }
                }
                details.innerHTML = ``;
                for (let j = 0; j < foods.length; j++) {
                    details.innerHTML += `
                        <span>${foods[j].quantity}</span>
                        <span>${foods[j].foodName}</span>
                        <br>
                         `

                }
            }
        </script>
</section>

