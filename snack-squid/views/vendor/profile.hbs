<section id="vanProfile">
    <title>Van Profile</title>

    <p>Current Location: </p>
    <span>{{Van.location}}</span>
    <form action="/vendor/profile/change" method="POST" id="newLocation">
        <p>Please enter the new location of the van</p>
        <input type="text" placeholder="(e.g. 61 Swanston St, Melbourne, VIC)" name="newLocation" class='newLocation'>
        <input type="submit" value="Change the Location">
    </form>
    <button id="find-me">Show my location</button><br />
    <a href="/vendor/profile/close" name="close">Close Business for Today</a>
    <a href="/vendor/profile/logout" name="logout">Log Out</a>

    <script>
        function geoFindMe() {

            function success(position) {
                const latitude = position.coords.latitude.toFixed(4);
                const longitude = position.coords.longitude.toFixed(4);
                const options = {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        'latitude': latitude,
                        'longitude': longitude
                    }),
                    redirect: 'follow'
                }
                try {
                    url = window.location.href
                    fetch(url, options).then(res => {
                        if (res.redirected) {
                            window.location.href = "/vendor/"
                        }
                    })
                }
                catch (err) {
                    console.log(err)
                }

            }
            function error() {
                alert('Unable to retrieve your location');
            }

            if (!navigator.geolocation) {
                console.log('Geolocation is not supported by your browser');
            } else {
                console.log('Locatingâ€¦');
                navigator.geolocation.getCurrentPosition(success, error);
            }

        }

        document.querySelector('#find-me').addEventListener('click', geoFindMe);
    </script>
</section>