<section id='order'>
    <title>order</title>
    <a href='/vendor/profile/logout' class="logout"> Logout </a>
    {{#each preparingOrders}}
    <div class="oneOrder">
        <div class="orderNum">
            <span>Order No.</span>
            <span class="orderId" hidden>{{this._id}}</span>
            <span>{{this.orderNo}}</span>
            <span>Time remaining: </span>
            <button id="fulfilled"> Mark as Fulfilled</button>
            <button>Hide</button>
        </div>

        <div class="orderDetail">
            <span>Customer Name: </span>
            <span>{{this.customerId.givenName}}</span>
            <span>Orders</span>
            <span class="detail">{{this.details}}</span>
        </div>
        {{/each}}

        <script>
            orderNums = document.querySelectorAll('.orderNum')
            for (let i = 0; i < orderNums.length; i++) {
                let fulfillbtn = document.querySelector('#fulfilled')
                console.log(fulfillbtn)
                let orderId = document.querySelector('.orderId').innerHTML
                console.log(orderId)
                fulfillbtn.addEventListener('click', function () {

                    const options = {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ 'orderId': orderId }),
                        redirect: 'follow'
                    }
                    try {
                        url = window.location.href + '/fulfill-order'
                        fetch(url, options).then(res => {
                            if (res.redirected) {
                                window.location.href = url
                            }
                        })
                    }
                    catch (err) {
                        console.log(err)
                    }
                })
            }

            orderDetail = document.querySelectorAll('.orderDetail')
            for (let i = 0; i < orderDetail.length; i++) {
                let tds = orderDetail[i].getElementsByClassName('detail');
                let foods;
                let details;

                for (let j = 0; j < tds.length; j++) {
                    if (tds[j].className == "detail") {
                        foods = JSON.parse(tds[j].innerHTML);
                        details = tds[j];
                    }
                }
                details.innerHTML = ``;
                for (let j = 0; j < foods.length; j++) {
                    details.innerHTML += `
                        <span>${foods[j].quantity}</span>
                        <span>${foods[j].foodName}</span>
                        <br>
                         `

                }
            }
        </script>
</section>